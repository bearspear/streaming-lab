<div class="library-container">
  <!-- Header -->
  <header class="library-header">
    <div class="header-content">
      <h1 class="logo">StreamFlix</h1>
      <nav class="nav-menu">
        <button class="nav-link" [class.active]="activeTab === 'movies'" (click)="switchTab('movies')">Movies</button>
        <button class="nav-link" [class.active]="activeTab === 'tv'" (click)="switchTab('tv')">TV Shows</button>
      </nav>
      <div class="header-actions">
        <button class="btn-search" routerLink="/search" title="Search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        <button class="btn-admin" *ngIf="(currentUser$ | async)?.is_admin" routerLink="/admin" title="Admin Panel">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
            <path d="M2 17l10 5 10-5"></path>
            <path d="M2 12l10 5 10-5"></path>
          </svg>
          Admin
        </button>
        <span class="user-name" *ngIf="currentUser$ | async as user">
          {{ user.username }}
        </span>
        <button class="btn-logout" (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="library-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <div class="spinner"></div>
      <p>Loading your library...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-message">
      <p>{{ errorMessage }}</p>
      <button class="btn-retry" (click)="loadMedia()">Retry</button>
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && !errorMessage">
      <!-- Continue Watching Section -->
      <section class="media-section" *ngIf="continueWatching.length > 0">
        <h2 class="section-title">Continue Watching</h2>
        <div class="media-grid">
          <app-media-card
            *ngFor="let watchItem of continueWatching"
            [media]="getMediaById(watchItem.media_item_id)!"
            [progress]="watchItem.progress"
          ></app-media-card>
        </div>
      </section>

      <!-- Movies Section -->
      <section class="media-section" *ngIf="activeTab === 'movies'">
        <h2 class="section-title">All Movies</h2>
        <div class="media-grid" *ngIf="mediaItems.length > 0">
          <app-media-card
            *ngFor="let media of mediaItems"
            [media]="media"
            [progress]="getProgress(media.id)"
          ></app-media-card>
        </div>
        <div *ngIf="mediaItems.length === 0" class="empty-state">
          <p>No movies found. Please scan your library to add content.</p>
        </div>
      </section>

      <!-- TV Shows Section -->
      <section class="media-section" *ngIf="activeTab === 'tv'">
        <h2 class="section-title">All TV Shows</h2>
        <div class="media-grid" *ngIf="tvShows.length > 0">
          <div class="tv-show-card" *ngFor="let show of tvShows" [routerLink]="['/tv', show.id]">
            <div class="card-image">
              <img [src]="show.poster_url || 'assets/images/placeholder.svg'" [alt]="show.title">
              <div class="card-overlay">
                <button class="play-button">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="card-info">
              <h3 class="card-title">{{ show.title }}</h3>
              <div class="card-meta">
                <span class="rating" *ngIf="show.rating">‚≠ê {{ show.rating }}/10</span>
                <span *ngIf="show.number_of_seasons">{{ show.number_of_seasons }} Season<span *ngIf="show.number_of_seasons !== 1">s</span></span>
              </div>
              <p class="card-overview" *ngIf="show.overview">{{ show.overview }}</p>
            </div>
          </div>
        </div>
        <div *ngIf="tvShows.length === 0" class="empty-state">
          <p>No TV shows found. Please scan your library to add content.</p>
        </div>
      </section>
    </div>
  </main>
</div>
